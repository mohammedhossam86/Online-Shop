<%- include('parts/header') %>
<%- include('parts/navbar') %>

<div class="container mt-5 cart-page">

    <!-- HEADER + ACTIONS -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold mb-0">üõí Your Cart</h3>

        <% if (items && items.length > 0) { %>
            <div class="d-flex gap-2">
                <form action="/cart/delete-all" method="POST">
                    <button class="btn btn-outline-danger btn-sm">
                        üóë Delete All
                    </button>
                </form>

                <form action="/confirm-orders" method="POST">
                    <% items.forEach(item => { %>
                        <input 
                            type="hidden"
                            name="cartId"
                            value="<%= [item._id] %>">
                    <% }) %>

                    <button class="btn btn-success btn-sm">
                        ‚úÖ Order All
                    </button>
                </form>
            </div>
        <% } %>
    </div>

    <% if (!items || items.length === 0) { %>
        <div class="alert alert-warning text-center">
            There are no items in your cart
        </div>
    <% } else { %>

        <div class="table-responsive">
            <table class="table table-hover align-middle cart-table">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Amount</th>
                        <th>Total</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    <% for (let i = 0; i < items.length; i++) { %>

                        <tr class="cart-item-row">

                            <td><%= i + 1 %></td>

                            <td class="fw-semibold">
                                <%= items[i].name %>
                            </td>

                            <td class="text-primary fw-bold">
                                $<%= items[i].price %>
                            </td>

                            <!-- UPDATE AMOUNT -->
                            <td style="max-width:140px;">
                                <form 
                                    action="/cart/save"
                                    method="POST"
                                    class="d-flex gap-2">

                                    <input 
                                        type="number"
                                        name="amount"
                                        class="form-control form-control-sm"
                                        value="<%= items[i].amount %>"
                                        min="1"
                                        required>

                                    <input 
                                        type="hidden"
                                        name="cartId"
                                        value="<%= items[i]._id %>">

                                    <button class="btn btn-success btn-sm">
                                        üíæ
                                    </button>
                                </form>
                            </td>

                            <!-- TOTAL -->
                            <td class="fw-bold text-success">
                                $<%= items[i].price * items[i].amount %>
                            </td>

                            <!-- ACTIONS -->
                            <td class="text-center">
                                <div class="d-flex justify-content-center gap-2">

                                    <!-- ORDER SINGLE -->
                                    <form action="/confirm-orders" method="POST">
                                        <input 
                                            type="hidden"
                                            name="cartId[]"
                                            value="<%= items[i]._id %>">
                                        <button class="btn btn-primary btn-sm">
                                            üõç Order
                                        </button>
                                    </form>

                                    <!-- DELETE SINGLE -->
                                    <form action="/cart/delete" method="POST">
                                        <input 
                                            type="hidden"
                                            name="cartId"
                                            value="<%= items[i]._id %>">
                                        <button class="btn btn-danger btn-sm">
                                            üóë
                                        </button>
                                    </form>

                                </div>
                            </td>

                        </tr>

                    <% } %>
                </tbody>
            </table>
        </div>

    <% } %>

</div>

<%- include('parts/footer') %>
